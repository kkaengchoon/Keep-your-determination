import streamlit as st
import pandas as pd
import pydeck as pdk
from urllib.error import URLError
import openai
import os
from datetime import datetime
import numpy as np
import base64
import random
import time
from openai import OpenAI



client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])

if "openai_model" not in st.session_state:
    st.session_state["openai_model"] = "gpt-4o"

if "messages" not in st.session_state:
    st.session_state.messages = []

for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

if prompt := st.chat_input("What is up?"):
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    with st.chat_message("assistant"):
        stream = client.chat.completions.create(
            model=st.session_state["openai_model"],
            messages=[
                {"role": m["role"], "content": m["content"]}
                for m in st.session_state.messages
            ],
            stream=True,
        )
        response = st.write_stream(stream)
    st.session_state.messages.append({"role": "assistant", "content": response})


def main():
    st.set_page_config(page_title="chatbot",
                       page_icon="https://cdn-icons-png.flaticon.com/128/14898/14898163.png")

    st.markdown("# chatbot")

